<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>K-Chords | æˆ‘çš„è¨‚å–®</title>
  <link rel="stylesheet" href="css/oldorders.css" />
</head>
<body>
  <header>
    <div class="header-inner">
      <h1><a href="index.html">K-Chords | K-å’Œå¼¦</a></h1>
      <div class="nav-container">
        <div class="search-wrapper">
          <input type="text" id="searchInput" class="search-bar" placeholder="æœå°‹å•†å“ã€åœ˜åã€å•†å“é¡å‹..." />
          <div id="searchResults" class="search-results"></div>
        </div>
        <nav>
          <ul>
            <li><a href="cart.html">è³¼ç‰©è»Š</a></li>
            <li><a href="loging.html">æœƒå“¡è¨»å†Š/ç™»å…¥</a></li>
            <li><a href="member.html">æœƒå“¡è³‡æ–™</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <nav class="member-nav">
    <ul class="member-nav-ul">
      <li><a href="member.html">å€‹äººè³‡è¨Š</a></li>
      <li><a href="points.html">æœƒå“¡é»æ•¸</a></li>
      <li class="active"><a href="oldorders.html">è¨‚å–®</a></li>
      <li><a href="wishlist.html">è¿½è¹¤æ¸…å–®</a></li>
    </ul>
  </nav>

  <div class="profile-container">
    <div class="info-section">
    <h3><span class="icon">ğŸ“¦</span> æ­·å²è¨‚å–®ç´€éŒ„</h3>
    <div id="order-list-container">
        </div>
    </div>
  </div> 

  <div id="reviewModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close-modal" onclick="closeReviewModal()">&times;</span>
      <h3>â­ å•†å“è©•åƒ¹</h3>
      <p id="review-order-id" style="color: #888; font-size: 0.8rem;"></p>
      <div class="star-rating">
        <input type="radio" id="star5" name="rating" value="5"><label for="star5">â˜…</label>
        <input type="radio" id="star4" name="rating" value="4"><label for="star4">â˜…</label>
        <input type="radio" id="star3" name="rating" value="3"><label for="star3">â˜…</label>
        <input type="radio" id="star2" name="rating" value="2"><label for="star2">â˜…</label>
        <input type="radio" id="star1" name="rating" value="1"><label for="star1">â˜…</label>
      </div>
      <textarea id="reviewText" placeholder="åˆ†äº«æ‚¨å°å•†å“çš„çœ‹æ³•..."></textarea>
      <button class="submit-review-btn" onclick="submitReview()">é€å‡ºè©•åƒ¹</button>
    </div>
  </div>

  <script>
    let currentReviewId = "";

    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('order-list-container');
        
        // 1. æ°¸ä¹…å‡è³‡æ–™
        const defaultOrder = {
            id: "KC20251225777",
            date: "2025-12-25",
            summary: "NMIXX 2026 å®˜æ–¹å¹´æ›†å¥—çµ„",
            amount: "1,580",
            status: "å·²å®Œæˆ",
            hasReviewed: false 
        };

        // 2. å–å¾—å…¶ä»–è¨‚å–®
        let orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];
        orderHistory = orderHistory.filter(order => order.id !== defaultOrder.id);
        const finalDisplayList = [defaultOrder, ...orderHistory];

        // 3. æ¸²æŸ“è¨‚å–®åˆ—è¡¨
        container.innerHTML = finalDisplayList.map(order => {
            const isFakeData = (order.id === "KC20251225777");
            const canReview = isFakeData || (order.status === 'å·²å®Œæˆ' && !order.hasReviewed);
            const statusClass = order.status === 'å·²å®Œæˆ' ? 'status-completed' : 'status-processing';

            return `
              <div class="order-card">
                <div class="order-header">
                  <span class="order-date">${order.date}</span>
                  <span class="order-status ${statusClass}">${order.status}</span>
                </div>
                <div class="order-body">
                  <div class="order-info">
                    <p class="order-id">è¨‚å–®ç·¨è™Ÿï¼š#${order.id}</p>
                    <p class="order-summary">${order.summary}</p>
                  </div>
                  <div class="order-amount">
                    <span class="total-price">NT$${order.amount}</span>
                  </div>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                  ${canReview ? 
                    `<button class="reorder-btn" onclick="openReviewModal('${order.id}')">è©•åƒ¹å•†å“</button>` : 
                    (order.hasReviewed ? '<span style="color:#D4AF37; font-size:0.9rem; align-self:center;">â˜… æ‚¨å·²è©•åƒ¹éæ­¤å•†å“</span>' : '')
                  }
                  <button class="reorder-btn" style="background:transparent; border:1px solid #444; color:#888;">æ„Ÿè¬è³¼è²·!</button>
                </div>
              </div>
            `;
        }).join('');
    });

    // --- ä»¥ä¸‹ç‚ºä¿®æ­£å¾Œçš„å‡½å¼ä½ç½® ---

    function openReviewModal(orderId) {
        currentReviewId = orderId;
        // é‡ç½®æ–‡å­—æ¡†èˆ‡æ˜Ÿç´š
        document.getElementById("reviewText").value = "";
        const checkedRating = document.querySelector('input[name="rating"]:checked');
        if (checkedRating) checkedRating.checked = false;

        document.getElementById("review-order-id").textContent = "æ­£åœ¨è©•åƒ¹è¨‚å–® #" + orderId;
        document.getElementById("reviewModal").style.display = "flex";
    }

    // é—œéµä¿®æ­£ï¼šå°‡æ­¤å‡½å¼ç¨ç«‹å‡ºä¾†
    function closeReviewModal() {
        document.getElementById("reviewModal").style.display = "none";
    }

    function submitReview() {
        const reviewTextArea = document.getElementById("reviewText");
        const text = reviewTextArea.value.trim();
        const ratingInput = document.querySelector('input[name="rating"]:checked');
        
        if (!ratingInput) {
            alert("è«‹é¸æ“‡æ˜Ÿç´šè©•åˆ†ï¼");
            return;
        }

        const starValue = ratingInput.value;
        const orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];
        let targetOrder = orderHistory.find(o => o.id === currentReviewId);
        
        if (currentReviewId === "KC20251225777") {
            targetOrder = { summary: "NMIXX 2026 å®˜æ–¹å¹´æ›†å¥—çµ„" };
        }

        const productName = targetOrder ? targetOrder.summary : "æœªçŸ¥å•†å“";

        const newReview = {
            productName: productName,
            star: parseInt(starValue),
            content: text || "ï¼ˆä½¿ç”¨è€…æœªç•™ä¸‹è©•è«–æ–‡å­—ï¼‰",
            date: new Date().toISOString().split('T')[0]
        };

        let productReviews = JSON.parse(localStorage.getItem('productReviews')) || [];
        productReviews.unshift(newReview);
        localStorage.setItem('productReviews', JSON.stringify(productReviews));

        alert("æ„Ÿè¬æ‚¨çš„è©•åƒ¹ï¼æ‚¨çš„è©•è«–å·²åŒæ­¥è‡³å€‹äººè³‡è¨Šä¸‹æ–¹ã€‚");
        location.reload(); 
    }

    // é»æ“ŠèƒŒæ™¯é—œé–‰å½ˆçª—
    window.onclick = function(event) {
        const modal = document.getElementById("reviewModal");
        if (event.target == modal) {
            closeReviewModal(); 
        }
    }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // å¾ localStorage è®€å–é»æ•¸ (é è¨­ 0)
        const savedPoints = localStorage.getItem('userPoints') || 0;
        document.getElementById('user-points').textContent = savedPoints;
    });
  </script>
  <script>
const products = [
  { id: 6, name: "CORTIS 2026 å¹´æ›†", keywords: ["cortis","å¹´æ›†","å®˜æ–¹å°ˆè¼¯"] },
  { id: 7, name: "NMIXX 2026 å¹´æ›†", keywords: ["nmixx","å¹´æ›†"] },
  { id: 8, name: "TXT 2026 å¹´æ›†", keywords: ["txt","å¹´æ›†"] },
  { id: 9, name: "IZNA 2026 å¹´æ›†", keywords: ["izna","å¹´æ›†"] },
  { id: 10, name: "KISS OF LIFE 2026 å¹´æ›†", keywords: ["kiss","kiof","å¹´æ›†"] },
  { id: 14, name: "å®˜æ–¹å‘¨é‚Šå¥—çµ„", keywords: ["å‘¨é‚Š","é…ä»¶"] }
];

const input = document.getElementById("searchInput");
const resultBox = document.getElementById("searchResults");

input.addEventListener("input", function () {
  const keyword = input.value.toLowerCase().trim();
  resultBox.innerHTML = "";
  if (!keyword) {
    resultBox.style.display = "none";
    return;
  }

  const matches = products.filter(p =>
    p.name.toLowerCase().includes(keyword) ||
    p.keywords.some(k => k.includes(keyword))
  );

  if (matches.length === 0) {
    resultBox.innerHTML = `<div>æ‰¾ä¸åˆ°ç›¸é—œå•†å“</div>`;
  } else {
    matches.forEach(p => {
      const div = document.createElement("div");
      div.textContent = p.name;
      div.onclick = () => {
        window.location.href = `product.html?id=${p.id}`;
      };
      resultBox.appendChild(div);
    });
  }

  resultBox.style.display = "block";
});

document.addEventListener("click", function (e) {
  if (!e.target.closest(".search-wrapper")) {
    resultBox.style.display = "none";
  }
});
</script>
    
  <footer class="site-footer">
    <div class="footer-box">
      <div class="footer-col">
        <h3>K-Chords | K-å’Œå¼¦</h3>
        <a href="https://www.instagram.com/uyhnz/" target="_blank">IG:K.Chords_official</a>
        <p>å•†å“å•é¡Œä¹Ÿå¯ä»¥ä¾†é€™è£¡è©¢å•</p>
        <a href="aboutus.html">é—œæ–¼æˆ‘å€‘</a>
      </div>
      <div class="footer-col">
        <h3>SERVICE</h3>
        <a href="afterservice.html">é€€æ›è²¨æœå‹™ After-sales service</a>
        <a href="qa.html">å¸¸è¦‹å•é¡Œ Q&A</a>
      </div>
      <div class="footer-col">
        <h3>COMPANY</h3>
        <a href="contact.html">è¯çµ¡æˆ‘å€‘</a>
        <a href="cooperate.html">åˆä½œæ´½è«‡</a>
        <a href="privacy.html">éš±ç§æ”¿ç­–</a>
        <a href="anti-fraud.html">åè©é¨™å…¬å‘Š</a>
        <p class="footer-time">å®¢æœæ™‚é–“ Mon.â€“Fri. 10:00â€“18:00 (ä¸å«ä¾‹å‡æ—¥)</p>
      </div>
    </div>
    <div class="footer-bottom">
      Â© 2026 K-Chords | K-å’Œå¼¦ All rights reserved.
    </div>
  </footer>
</body>
</html>