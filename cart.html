<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>K-Chords | K-和弦</title>
  <link rel="stylesheet" href="css/cart.css" />
</head>
<body>
  <header>
    <div class="header-inner">
      <h1><a href="index.html">K-Chords | K-和弦</a></h1>
      <div class="nav-container">
        <div class="search-wrapper">
          <input type="text" id="searchInput" class="search-bar" placeholder="搜尋商品、團名、商品類型..." />
          <div id="searchResults" class="search-results"></div>
        </div>
        <nav>
          <ul>
            <li><a href="cart.html">購物車</a></li>
            <li><a href="loging.html">會員註冊/登入</a></li>
            <li><a href="member.html">會員資料</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <div class="container">
  <div class="stepper">
    <div class="step active"><span>1</span><p>購物車</p></div>
    <div class="line"></div>
    <div class="step"><span>2</span><p>填寫資料</p></div>
    <div class="line"></div>
    <div class="step"><span>3</span><p>訂單確認</p></div>
  </div>

  <div class="cart-layout">
    <div class="cart-left">
      <h1 class="section-h2">購物車清單</h1>
      
      <div class="cart-header-row">
          <span class="col-info">商品資料</span>
          <span class="col-price">單件價格</span>
          <span class="col-qty">數量</span>
          <span class="col-sub">小計</span>
      </div>
      
      <div id="cartContainer"></div>
      
      <div class="promo-hint-box">
          <p><span class="badge">優惠促銷</span> 消費滿 $1,200 免運費，再買 <span id="nextTier" style="color:#55a630; font-weight:bold;">$0</span> 即享免運</p>
          <button class="clear-btn" id="clearCart">清空購物車</button>
      </div>
    </div>

    <div class="cart-right">
      <div class="summary-box">
        <h2>訂單資訊</h2>
        <div class="summary-line"><span>小計：</span><span id="summarySubtotal">$0</span></div>
        <div class="summary-line"><span>運費：</span><span>NT$65</span></div>
        
        <div class="summary-total">
          <span>合計：</span>
          <span id="cartTotal">$0</span>
        </div>
        
        <button class="checkout-btn" id="checkoutCart" style="background: #7CB342;">前往結帳</button>
        
        <p class="points-text">訂單完成後獲得點數 <span style="color:#fff;">+90 點</span></p>
      </div>
      
      <a href="index.html" class="back-btn">← 返回商品總覽</a>
    </div>
  </div>
</div>

  <footer class="site-footer">
    <div class="footer-box">
      <div class="footer-col">
        <h3>K-Chords | K-和弦</h3>
        <a href="https://www.instagram.com/uyhnz/" target="_blank">IG:K.Chords_official</a>
        <p>商品問題也可以來這裡詢問</p>
        <a href="aboutus.html">關於我們</a>
      </div>
      <div class="footer-col">
        <h3>SERVICE</h3>
        <a href="afterservice.html">退換貨服務 After-sales service</a>
        <a href="qa.html">常見問題 Q&A</a>
      </div>
      <div class="footer-col">
        <h3>COMPANY</h3>
        <a href="contact.html">聯絡我們</a>
        <a href="cooperate.html">合作洽談</a>
        <a href="privacy.html">隱私政策</a>
        <a href="anti-fraud.html">反詐騙公告</a>
        <p class="footer-time">客服時間 Mon.–Fri. 10:00–18:00 (不含例假日)</p>
      </div>
    </div>
    <div class="footer-bottom">
      © 2026 K-Chords | K-和弦 All rights reserved.
    </div>
  </footer>
<script>
const products = [
  { id: 6, name: "CORTIS 2026 年曆", keywords: ["cortis","年曆","官方專輯"] },
  { id: 7, name: "NMIXX 2026 年曆", keywords: ["nmixx","年曆"] },
  { id: 8, name: "TXT 2026 年曆", keywords: ["txt","年曆"] },
  { id: 9, name: "IZNA 2026 年曆", keywords: ["izna","年曆"] },
  { id: 10, name: "KISS OF LIFE 2026 年曆", keywords: ["kiss","kiof","年曆"] },
  { id: 14, name: "官方周邊套組", keywords: ["周邊","配件"] }
];

const input = document.getElementById("searchInput");
const resultBox = document.getElementById("searchResults");

input.addEventListener("input", function () {
  const keyword = input.value.toLowerCase().trim();
  resultBox.innerHTML = "";
  if (!keyword) {
    resultBox.style.display = "none";
    return;
  }

  const matches = products.filter(p =>
    p.name.toLowerCase().includes(keyword) ||
    p.keywords.some(k => k.includes(keyword))
  );

  if (matches.length === 0) {
    resultBox.innerHTML = `<div>找不到相關商品</div>`;
  } else {
    matches.forEach(p => {
      const div = document.createElement("div");
      div.textContent = p.name;
      div.onclick = () => {
        window.location.href = `product.html?id=${p.id}`;
      };
      resultBox.appendChild(div);
    });
  }

  resultBox.style.display = "block";
});

document.addEventListener("click", function (e) {
  if (!e.target.closest(".search-wrapper")) {
    resultBox.style.display = "none";
  }
});
</script>
<script>
// 確保 DOM 載入後才執行
document.addEventListener("DOMContentLoaded", () => {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    const cartContainer = document.getElementById("cartContainer");
    const clearBtn = document.getElementById("clearCart");
    const checkoutBtn = document.getElementById("checkoutCart");

    // 渲染函式
    function renderCart() {
        if (!cartContainer) return;
        
        let total = 0;
        if (cart.length === 0) {
            cartContainer.innerHTML = `<p style="text-align: center; padding: 2rem; color: #888;">購物車是空的</p>`;
            updateUI(0);
            return;
        }

        // 為了減少閃爍，我們構建一個字串一次性寫入，而不是逐個 appendChild
        let htmlContent = "";
        cart.forEach((item, index) => {
            const subtotal = item.price * item.quantity;
            total += subtotal;
            htmlContent += `
                <div class="cart-item">
                    <div class="col-info" style="display:flex; align-items:center; flex:2;">
                        <img src="${item.image}" alt="${item.name}" style="width:70px; margin-right:15px; border-radius:8px;" />
                        <div>
                            <h2 style="font-size:1rem; color:#fff; margin:0;">${item.name}</h2>
                            <p style="font-size:0.8rem; color:#888; margin:5px 0;">預購商品</p>
                        </div>
                    </div>
                    <div class="col-price" style="flex:1; text-align:center;">$${item.price}</div>
                    <div class="col-qty" style="flex:1; text-align:center;">
                        <div class="quantity-control" style="display:flex; justify-content:center; align-items:center; gap:10px;">
                            <button class="quantity-btn minus" data-index="${index}" ${item.quantity <= 1 ? 'disabled' : ''}>-</button>
                            <span class="quantity-display" style="color:#fff; font-weight:bold;">${item.quantity}</span>
                            <button class="quantity-btn plus" data-index="${index}">+</button>
                        </div>
                        <button class="remove-btn" data-index="${index}" style="background:none; border:none; color:#888; text-decoration:underline; cursor:pointer; font-size:0.8rem; margin-top:8px;">移除</button>
                    </div>
                    <div class="col-sub" style="flex:1; text-align:center; color:#D4AF37; font-weight:bold;">$${subtotal}</div>
                </div>
            `;
        });
        
        cartContainer.innerHTML = htmlContent;
        updateUI(total);
    }

    function updateUI(total) {
    const summarySubtotal = document.getElementById("summarySubtotal"); // 訂單資訊中的小計
    const cartTotal = document.getElementById("cartTotal");             // 下方的合計 (含運費)
    const nextTier = document.getElementById("nextTier");               // 免運提示中的差額

    const threshold = 1200;
    const shippingCharge = 65;
    
    // 1. 計算運費
    let currentShipping = (total >= threshold || total === 0) ? 0 : shippingCharge;

    // 2. 更新「訂單資訊」中的小計 ($${total})
    if (summarySubtotal) {
        summarySubtotal.textContent = `$${total}`;
    }
    
    // 3. 更新「運費」那一行的文字顯示
    // 這裡使用選擇器抓取「小計」後面的那一行「運費」
    const summaryLines = document.querySelectorAll(".summary-line span:last-child");
    if (summaryLines.length >= 2) {
        summaryLines[1].textContent = currentShipping === 0 ? "NT$0" : `NT$${shippingCharge}`;
    }

    // 4. 更新下方的「合計」 (小計 + 運費)
    if (cartTotal) {
        cartTotal.textContent = `NT$${total + currentShipping}`;
    }

    // 5. 更新免運提示區 (確保 ID 每次都被重新寫入)
    if (nextTier) {
        const hintParent = nextTier.parentElement;
        const diff = threshold - total;

        if (total === 0) {
            hintParent.innerHTML = `<span class="badge">優惠促銷</span> 消費滿 $1,200 免運費，再買 <span id="nextTier" style="color:#55a630; font-weight:bold;">$1,200</span> 即享免運`;
        } else if (diff > 0) {
            hintParent.innerHTML = `<span class="badge">優惠促銷</span> 消費滿 $1,200 免運費，再買 <span id="nextTier" style="color:#55a630; font-weight:bold;">$${diff}</span> 即享免運`;
        } else {
            hintParent.innerHTML = `<span class="badge">優惠促銷</span> <span id="nextTier" style="color:#55a630; font-weight:bold;">恭喜！已達成免運優惠</span>`;
        }
    }
}

    // 點擊事件：數量增減與移除
    cartContainer.addEventListener("click", (e) => {
        const index = e.target.dataset.index;
        if (index === undefined) return;

        if (e.target.classList.contains("plus")) {
            cart[index].quantity = parseInt(cart[index].quantity) + 1;
        } else if (e.target.classList.contains("minus")) {
            if (cart[index].quantity > 1) cart[index].quantity -= 1;
        } else if (e.target.classList.contains("remove-btn")) {
            if (confirm("確定移除商品？")) cart.splice(index, 1);
        }

        localStorage.setItem("cart", JSON.stringify(cart));
        renderCart(); // 執行渲染
    });

    // 清空購物車功能 (修復此按鈕)
    if (clearBtn) {
        clearBtn.addEventListener("click", () => {
            if (confirm("確定要清空購物車嗎？")) {
                cart = [];
                localStorage.removeItem("cart");
                renderCart();
            }
        });
    }

    // 結帳按鈕功能
    if (checkoutBtn) {
        checkoutBtn.addEventListener("click", () => {
            if (cart.length === 0) return alert("購物車是空的！");
            window.location.href = "checkout.html";
        });
    }

    // 初始執行
    renderCart();
});
</script>

</body>
</html>