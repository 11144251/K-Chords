<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>K-Chords | K-和弦</title>
  <link rel="stylesheet" href="css/cart.css" />
</head>
<body>
  <header>
    <div class="header-inner">
      <h1><a href="index.html">K-Chords | K-和弦</a></h1>
      <div class="nav-container">
        <div class="search-wrapper">
          <input type="text" id="searchInput" class="search-bar" placeholder="搜尋商品、團名、商品類型..." />
          <div id="searchResults" class="search-results"></div>
        </div>
        <nav>
          <ul>
            <li><a href="cart.html">購物車</a></li>
            <li><a href="loging.html">會員註冊/登入</a></li>
            <li><a href="member.html">會員資料</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

<div class="container">
    <div class="stepper">
      <div class="step"><span>1</span><p>購物車</p></div>
      <div class="line"></div>
      <div class="step"><span>2</span><p>填寫資料</p></div>
      <div class="line"></div>
      <div class="step active"><span>3</span><p>訂單確認</p></div>
    </div>

    <div class="submit-success-box">
        <div class="success-icon">✓</div>
        <h2>感謝您的購買！</h2>
        <p>您的訂單已成功送出，以下是您的訂單詳情：</p>
    </div>

    <div class="cart-layout">
      <div class="cart-left" style="background: #2C2C2C; padding: 2rem; border-radius: 16px;">
        <h2 class="section-h2">訂單清單</h2>
        <div id="orderItemsContainer">
            </div>

        <div class="order-info-grid">
            <div class="info-group">
                <label>付款方式</label>
                <p id="displayPayment">-</p>
            </div>
            <div class="info-group">
                <label>送貨門市</label>
                <p id="displayStore">-</p>
            </div>
            <div class="info-group">
                <label>收件人</label>
                <p id="displayCustomer">-</p>
            </div>
        </div>
      </div>

      <div class="cart-right">
        <div class="summary-box">
          <h2>結帳總額</h2>
          <div class="summary-total" style="border-top:none; margin-top:0; padding-top:0;">
            <span style="font-size: 1.5rem;">合計：</span>
            <span id="displayTotal" style="font-size: 1.5rem;">$0</span>
          </div>
          <button class="checkout-btn" onclick="window.location.href='index.html'" style="background: #D4AF37; color: #1a1a1a;">回到首頁</button>
        </div>
      </div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const orderData = JSON.parse(localStorage.getItem("finalOrder"));

    if (!orderData) {
        alert("找不到訂單資訊，將返回首頁");
        window.location.href = "index.html";
        return;
    }

    // --- 渲染畫面內容 ---
    document.getElementById("displayPayment").textContent = orderData.paymentMethod;
    document.getElementById("displayStore").textContent = orderData.storeName;
    document.getElementById("displayCustomer").textContent = orderData.customerName;
    document.getElementById("displayTotal").textContent = orderData.totalAmount;

    // --- 核心修改：自動存入歷史紀錄 ---
    // 檢查這筆訂單是否已經存過，避免重新整理頁面重複存入
    let orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];
    const isAlreadySaved = orderHistory.some(order => order.id === orderData.orderId);

    if (!isAlreadySaved) {
        const historyEntry = {
            id: orderData.orderId || "KC" + Date.now(), // 使用結帳頁產生的編號或時間戳
            date: new Date().toISOString().split('T')[0],
            summary: orderData.items.map(i => i.name).join('、').substring(0, 20) + "...",
            amount: orderData.totalAmount.replace('$', ''), // 移除錢字號方便顯示
            status: "處理中"
        };
        orderHistory.unshift(historyEntry);
        localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
    }

    // --- 渲染商品清單 (保持你原本的內容) ---
    const container = document.getElementById("orderItemsContainer");
    if (container && orderData.items) {
        container.innerHTML = ""; 
        orderData.items.forEach(item => {
            const div = document.createElement("div");
            div.className = "order-confirm-item";
            div.style.cssText = "display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #444;";
            div.innerHTML = `
                <div>
                    <span style="font-weight:bold; color:#fff;">${item.name}</span>
                    <p style="font-size:0.8rem; color:#888; margin: 5px 0 0 0;">數量：${item.quantity}</p>
                </div>
                <span style="color:#D4AF37;">$${item.price * item.quantity}</span>
            `;
            container.appendChild(div);
        });
    }

    initSearch();
});

// 將搜尋功能獨立出來
function initSearch() {
    const products = [
        { id: 6, name: "CORTIS 2026 年曆", keywords: ["cortis","年曆","官方專輯"] },
        { id: 7, name: "NMIXX 2026 年曆", keywords: ["nmixx","年曆"] },
        { id: 8, name: "TXT 2026 年曆", keywords: ["txt","年曆"] },
        { id: 9, name: "IZNA 2026 年曆", keywords: ["izna","年曆"] },
        { id: 10, name: "KISS OF LIFE 2026 年曆", keywords: ["kiss","kiof","年曆"] },
        { id: 14, name: "官方周邊套組", keywords: ["周邊","配件"] }
    ];
    const input = document.getElementById("searchInput");
    const resultBox = document.getElementById("searchResults");
    if (!input) return;

    input.addEventListener("input", function () {
        const keyword = input.value.toLowerCase().trim();
        resultBox.innerHTML = "";
        if (!keyword) { resultBox.style.display = "none"; return; }
        const matches = products.filter(p => p.name.toLowerCase().includes(keyword) || p.keywords.some(k => k.includes(keyword)));
        if (matches.length === 0) {
            resultBox.innerHTML = `<div>找不到相關商品</div>`;
        } else {
            matches.forEach(p => {
                const div = document.createElement("div");
                div.textContent = p.name;
                div.onclick = () => { window.location.href = `product.html?id=${p.id}`; };
                resultBox.appendChild(div);
            });
        }
        resultBox.style.display = "block";
    });
}
</script>

    <script>
const products = [
  { id: 6, name: "CORTIS 2026 年曆", keywords: ["cortis","年曆","官方專輯"] },
  { id: 7, name: "NMIXX 2026 年曆", keywords: ["nmixx","年曆"] },
  { id: 8, name: "TXT 2026 年曆", keywords: ["txt","年曆"] },
  { id: 9, name: "IZNA 2026 年曆", keywords: ["izna","年曆"] },
  { id: 10, name: "KISS OF LIFE 2026 年曆", keywords: ["kiss","kiof","年曆"] },
  { id: 14, name: "官方周邊套組", keywords: ["周邊","配件"] }
];

const input = document.getElementById("searchInput");
const resultBox = document.getElementById("searchResults");

input.addEventListener("input", function () {
  const keyword = input.value.toLowerCase().trim();
  resultBox.innerHTML = "";
  if (!keyword) {
    resultBox.style.display = "none";
    return;
  }

  const matches = products.filter(p =>
    p.name.toLowerCase().includes(keyword) ||
    p.keywords.some(k => k.includes(keyword))
  );

  if (matches.length === 0) {
    resultBox.innerHTML = `<div>找不到相關商品</div>`;
  } else {
    matches.forEach(p => {
      const div = document.createElement("div");
      div.textContent = p.name;
      div.onclick = () => {
        window.location.href = `product.html?id=${p.id}`;
      };
      resultBox.appendChild(div);
    });
  }

  resultBox.style.display = "block";
});

document.addEventListener("click", function (e) {
  if (!e.target.closest(".search-wrapper")) {
    resultBox.style.display = "none";
  }
});

  // 假設這是點擊提交按鈕的 function
function submitOrder() {
    // 1. 產生訂單資料
    const newOrder = {
        id: "KC" + Date.now(), // 用時間戳記產生唯一編號
        date: new Date().toISOString().split('T')[0], // 取得今天日期 (YYYY-MM-DD)
        summary: "CORTIS 2026 年曆 等商品", // 這裡可以抓取購物車的商品名稱
        amount: "1,280", // 這裡抓取結帳總金額
        status: "處理中"
    };

    // 2. 從 localStorage 取得現有訂單列表，若無則建立空陣列
    let orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];

    // 3. 將新訂單推入陣列（最新的排在最前面）
    orderHistory.unshift(newOrder);

    // 4. 存回 localStorage
    localStorage.setItem('orderHistory', JSON.stringify(orderHistory));

    alert("訂單已成功提交！");
    window.location.href = "oldorders.html"; // 跳轉到歷史訂單頁
}
</script>

  <footer class="site-footer">
    <div class="footer-box">
      <div class="footer-col">
        <h3>K-Chords | K-和弦</h3>
        <a href="https://www.instagram.com/uyhnz/" target="_blank">IG:K.Chords_official</a>
        <p>商品問題也可以來這裡詢問</p>
        <a href="aboutus.html">關於我們</a>
      </div>
      <div class="footer-col">
        <h3>SERVICE</h3>
        <a href="afterservice.html">退換貨服務 After-sales service</a>
        <a href="qa.html">常見問題 Q&A</a>
      </div>
      <div class="footer-col">
        <h3>COMPANY</h3>
        <a href="contact.html">聯絡我們</a>
        <a href="cooperate.html">合作洽談</a>
        <a href="privacy.html">隱私政策</a>
        <a href="anti-fraud.html">反詐騙公告</a>
        <p class="footer-time">客服時間 Mon.–Fri. 10:00–18:00 (不含例假日)</p>
      </div>
    </div>
    <div class="footer-bottom">
      © 2026 K-Chords | K-和弦 All rights reserved.
    </div>
  </footer>

</body>
</html>